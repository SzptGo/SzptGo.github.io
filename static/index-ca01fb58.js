import{b as e,a,r as l,n as r,h as t,Y as o,j as n,w as d,i as u,f as s,aj as i,o as p,l as c,ak as m,C as g,al as f,y as h,ag as v,am as b,D as _,ad as y,F as V,p as w,E as C,ap as k,aq as x,ae as z,ar as P,as as I,_ as U}from"./index-370541b8.js";import{u as j}from"./usePagination-d9de12be.js";const q={class:"app-container"},S={class:"toolbar-wrapper"},D={class:"table-wrapper"},B={class:"pager-wrapper"},F=["src"],E=e({name:"ElementPlus"}),G=U(e({...E,setup(e){const U=a(!1),E=l("http://110.41.150.2:32976/image"),G=l("http://110.41.150.2/api/upload"),{paginationData:O,handleCurrentChange:R,handleSizeChange:T}=j(),$=l([{label:"普通用户",value:"0"},{label:" 管理员",value:"1"}]),A=e=>{Y.avatar=e.data},J=e=>{const a="image/jpeg"===e.type||"image/png"===e.type,l=e.size/1024/1024<2;return a||C.error("上传头像图片只能是 JPG/PNG 格式!"),l||C.error("上传头像图片大小不能超过 2MB!"),a&&l},M=a(!1),N=a(null),Y=l({id:void 0,phone:"",password:"",roleId:"0",avatar:"",mail:"",name:"",message:"",balance:void 0}),H=l({phone:[{required:!0,message:"请填写手机号",trigger:"blur"},{pattern:/^1[345789]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],name:[{required:!0,message:"请填写用户名",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6-20个字符之间",trigger:"blur"}],message:[{max:50,message:"个人签名不能超过50个字符",trigger:"blur",required:!1}],mail:[{required:!0,message:"请填写邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色权限",trigger:"change"}],avatar:[{required:!0,message:"请上传图片",trigger:"change"}]}),K=()=>{var e;null==(e=N.value)||e.validate((e=>{if(!e)return!1;void 0===Y.id?k(Y).then((e=>{"200"===e.code?(C.success("新增成功"),M.value=!1,Z()):C.error(e.msg)})):x(Y).then((e=>{"200"===e.code?(C.success("修改成功"),M.value=!1,Z()):C.error(e.msg)}))}))},L=()=>{Object.assign(Y,{id:void 0,phone:"",password:"",roleId:"0",avatar:"",mail:"",name:"",message:"",balance:void 0})},Q=a([]),W=a(null),X=l({phone:""}),Z=()=>{U.value=!0,I().then((e=>{const a=e.data;O.total=a.total,Q.value=a.records})),U.value=!1},ee=()=>{1===O.currentPage&&Z(),O.currentPage=1},ae=()=>{var e;null==(e=W.value)||e.resetFields(),1===O.currentPage&&Z(),O.currentPage=1},le=()=>{Z()};return r([()=>O.currentPage,()=>O.pageSize],Z,{immediate:!0}),(e,a)=>{const l=s("el-input"),r=s("el-form-item"),k=s("el-button"),x=s("el-form"),I=s("el-card"),j=s("el-tooltip"),re=s("el-table-column"),te=s("Avatar"),oe=s("el-avatar"),ne=s("el-tag"),de=s("el-table"),ue=s("el-pagination"),se=s("el-icon"),ie=s("el-upload"),pe=s("el-option"),ce=s("el-select"),me=s("el-dialog"),ge=i("loading");return p(),t("div",q,[o((p(),n(I,{shadow:"never",class:"search-wrapper"},{default:d((()=>[u(x,{ref_key:"searchFormRef",ref:W,inline:!0,model:X},{default:d((()=>[u(r,{prop:"phone",label:"用户名"},{default:d((()=>[u(l,{modelValue:X.phone,"onUpdate:modelValue":a[0]||(a[0]=e=>X.phone=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),u(r,{prop:"phone",label:"手机号"},{default:d((()=>[u(l,{modelValue:X.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>X.phone=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),u(r,null,{default:d((()=>[u(k,{type:"primary",icon:c(m),onClick:ee},{default:d((()=>[g("查询")])),_:1},8,["icon"]),u(k,{icon:c(f),onClick:ae},{default:d((()=>[g("重置")])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"])])),_:1})),[[ge,U.value]]),o((p(),n(I,{shadow:"never"},{default:d((()=>[h("div",S,[h("div",null,[u(k,{type:"primary",icon:c(v),onClick:a[2]||(a[2]=e=>M.value=!0)},{default:d((()=>[g("新增用户")])),_:1},8,["icon"])]),h("div",null,[u(j,{content:"刷新表格"},{default:d((()=>[u(k,{type:"primary",icon:c(b),circle:"",onClick:le},null,8,["icon"])])),_:1})])]),h("div",D,[u(de,{data:Q.value},{default:d((()=>[u(re,{prop:"id",align:"center",label:"ID"}),u(re,{prop:"name",label:"头像",align:"center"},{default:d((e=>[u(oe,{size:60,src:E+e.row.avatar},{default:d((()=>[u(te)])),_:2},1032,["src"])])),_:1}),u(re,{prop:"name",label:"用户名",align:"center"}),u(re,{prop:"roleId",label:"角色",align:"center"},{default:d((e=>["0"===e.row.roleId?(p(),n(ne,{key:0,effect:"plain"},{default:d((()=>[g("普通用户")])),_:1})):_("",!0),"1"===e.row.roleId?(p(),n(ne,{key:1,type:"danger",effect:"plain"},{default:d((()=>[g("管理员")])),_:1})):_("",!0)])),_:1}),u(re,{prop:"phone",label:"手机号",align:"center"}),u(re,{prop:"mail",label:"邮箱",align:"center"}),u(re,{prop:"message",label:"留言",align:"center"}),u(re,{prop:"balance",label:"余额(￥)",align:"center"}),u(re,{prop:"createDate",label:"创建时间",align:"center"}),u(re,{fixed:"right",label:"操作",width:"150",align:"center"},{default:d((e=>[u(k,{type:"primary",text:"",bg:"",size:"small",onClick:a=>{return l=e.row,Object.assign(Y,l),Y.password=void 0,void(M.value=!0);var l}},{default:d((()=>[g("修改")])),_:2},1032,["onClick"]),u(k,{type:"danger",text:"",bg:"",size:"small",onClick:a=>{return l=e.row,void z.confirm(`正在删除用户：${l.name}，确认删除？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{P(l.id).then((e=>{e.data?(C.success("删除成功"),Z()):C.error("删除失败")}))}));var l}},{default:d((()=>[g("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),h("div",B,[u(ue,{background:"",layout:c(O).layout,"page-sizes":c(O).pageSizes,total:c(O).total,"page-size":c(O).pageSize,currentPage:c(O).currentPage,onSizeChange:c(T),onCurrentChange:c(R)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[ge,U.value]]),u(me,{modelValue:M.value,"onUpdate:modelValue":a[11]||(a[11]=e=>M.value=e),title:void 0===Y.id?"新增用户":"修改用户",onClose:L,width:"500px"},{footer:d((()=>[u(k,{onClick:a[10]||(a[10]=e=>M.value=!1)},{default:d((()=>[g("取消")])),_:1}),u(k,{type:"primary",onClick:K},{default:d((()=>[g("确认")])),_:1})])),default:d((()=>[u(x,{ref_key:"formRef",ref:N,model:Y,rules:H,"label-width":"80px","label-position":"left"},{default:d((()=>[u(r,{label:"头像",prop:"avatar"},{default:d((()=>[u(ie,{class:"avatar-uploader",action:G,"show-file-list":!1,"on-success":A,"before-upload":J},{default:d((()=>[Y.avatar?(p(),t("img",{key:0,src:E+Y.avatar,class:"avatar"},null,8,F)):(p(),n(se,{key:1,class:"avatar-uploader-icon"},{default:d((()=>[u(c(y))])),_:1}))])),_:1},8,["action"])])),_:1}),u(r,{prop:"phone",label:"手机号"},{default:d((()=>[u(l,{modelValue:Y.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.phone=e),placeholder:"请输入",maxlength:"11"},null,8,["modelValue"])])),_:1}),u(r,{prop:"name",label:"用户名"},{default:d((()=>[u(l,{modelValue:Y.name,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.name=e),placeholder:"请输入昵称",maxlength:"16"},null,8,["modelValue"])])),_:1}),Y.id?_("",!0):(p(),n(r,{key:0,prop:"password",label:"密码"},{default:d((()=>[u(l,{modelValue:Y.password,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.password=e),type:"password",placeholder:"请输入",maxlength:"20"},null,8,["modelValue"])])),_:1})),u(r,{prop:"mail",label:"邮箱"},{default:d((()=>[u(l,{modelValue:Y.mail,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.mail=e),placeholder:"请输入邮箱",maxlength:"30"},null,8,["modelValue"])])),_:1}),u(r,{prop:"balance",label:"余额"},{default:d((()=>[u(l,{modelValue:Y.balance,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.balance=e),placeholder:"请输入余额",type:"number",step:"1"},null,8,["modelValue"])])),_:1}),u(r,{label:"角色权限",prop:"roleId"},{default:d((()=>[u(ce,{modelValue:Y.roleId,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.roleId=e),class:"full-width-input",clearable:"",placeholder:"角色"},{default:d((()=>[(p(!0),t(V,null,w($,((e,a)=>(p(),n(pe,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(r,{prop:"message",label:"个人签名"},{default:d((()=>[u(l,{modelValue:Y.message,"onUpdate:modelValue":a[9]||(a[9]=e=>Y.message=e),placeholder:"请输入个人签名",maxlength:"50",type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-981d8784"]]);export{G as default};
